(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{340:function(t,e,s){"use strict";s.r(e);var n=s(3),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("h3",{attrs:{id:"流水式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#流水式"}},[t._v("#")]),t._v(" 流水式")]),t._v(" "),s("p",[t._v("传统写MD文章，然后提交到Github并本地执行build打包完上传到云服务器")]),t._v(" "),s("h3",{attrs:{id:"自动化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动化"}},[t._v("#")]),t._v(" 自动化")]),t._v(" "),s("p",[t._v("新建gh-pages分支,配合pages.github.io和Github Actions"),s("br"),t._v("\n触发push到master主分支的行为就执行.github/workflows/*.yml下的文件.而达到自动化打包更新")]),t._v(" "),s("h3",{attrs:{id:"加快网络访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加快网络访问"}},[t._v("#")]),t._v(" 加快网络访问")]),t._v(" "),s("p",[t._v("毕竟是国外的网络,对于国内访问非常卡,于是此篇文章的目是"),s("br"),t._v("\n只要master有更新便同步执行云服务器的shell脚本更新.生成最新的文章页面")]),t._v(" "),s("h2",{attrs:{id:"准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[t._v("#")]),t._v(" 准备")]),t._v(" "),s("h3",{attrs:{id:"切换-npm-镜像源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#切换-npm-镜像源"}},[t._v("#")]),t._v(" 切换 NPM 镜像源")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm install -g nrm\n\n/**\n  npm ---- https://registry.npmjs.org/\n  cnpm --- http://r.cnpmjs.org/\n  taobao - http://registry.npm.taobao.org/\n  eu ----- http://registry.npmjs.eu/\n  au ----- http://registry.npmjs.org.au/\n  sl ----- http://npm.strongloop.com/\n  nj ----- https://registry.nodejitsu.com/\n**/\n \n \n#切换到taobao\nnrm use taobao\n")])])]),s("h2",{attrs:{id:"选用开源项目并部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选用开源项目并部署"}},[t._v("#")]),t._v(" 选用开源项目并部署")]),t._v(" "),s("p",[t._v("本文采用此开源项目："),s("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/views/1.x/",target:"_blank",rel:"noopener noreferrer"}},[t._v("vuepress-theme-reco"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/views/other/domain.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pages 自定义域名"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/views/other/deploy.html#github",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pages 部署"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/views/other/github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用 GitHub Actions 自动部署博客"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"开始部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始部署"}},[t._v("#")]),t._v(" 开始部署")]),t._v(" "),s("p",[t._v("按照以上的教程链接就能成功.")]),t._v(" "),s("p",[t._v("如果还有不懂的就看下我的github："),s("a",{attrs:{href:"https://github.com/xzwiaoe/xzwiao.github.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("xzwiao.github.io"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("里面有两个分支master(主分支.放源码)和gh-pages(存放build编译后的包)")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# ${home}/.github/workflows/main.yml\nname: Deploy GitHub Pages\n\n# 触发条件：在 push 到 master 分支后\non:\n  push:\n    branches:\n      - master\n\n# 任务\njobs:\n  build-and-deploy:\n    # 服务器环境：最新版 Ubuntu\n    runs-on: ubuntu-latest\n    steps:\n      # 拉取代码\n      - name: Checkout\n        uses: actions/checkout@v2\n        with:\n          persist-credentials: false\n\n      # 生成静态文件\n      - name: Build\n        run: npm install && npm run build\n\n      # 部署到 GitHub Pages\n      - name: Deploy\n        uses: JamesIves/github-pages-deploy-action@releases/v3\n        with:\n          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}\n          BRANCH: gh-pages\n          FOLDER: dist\n")])])]),s("h2",{attrs:{id:"github-actions自动触发服务器更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions自动触发服务器更新"}},[t._v("#")]),t._v(" github Actions自动触发服务器更新")]),t._v(" "),s("p",[t._v("由于github.io的服务器是在国外.并且并发量比较大，导致带宽的严重缓慢"),s("br"),t._v("\n于是便有了部署到个人的阿里云服务器上的想法\\")]),t._v(" "),s("h3",{attrs:{id:"生成rsa公私匙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成rsa公私匙"}},[t._v("#")]),t._v(" 生成RSA公私匙")]),t._v(" "),s("p",[t._v("这里推荐码云的教程："),s("a",{attrs:{href:"https://gitee.com/help/articles/4191#article-header0",target:"_blank",rel:"noopener noreferrer"}},[t._v("生成/添加SSH公钥"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("TIP:记得在云服务器上操作")]),t._v(" "),s("h3",{attrs:{id:"添加公匙到github"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加公匙到github"}},[t._v("#")]),t._v(" 添加公匙到Github")]),t._v(" "),s("p",[t._v("把在云服务生成的id_rsa.pub添加到settings->Deploy Keys中(如下图)\n"),s("img",{attrs:{src:"https://fublog.oss-cn-shenzhen.aliyuncs.com/vuepress/vuepress_deploy.png",alt:"添加公匙到Github"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#克隆项目到云服务器\ngit clone https://github.com/xzwiaoe/xzwiao.github.io.git\n#切换到分支gh-pages(记得cd到项目根目录)\ngit checkout gh-pages\n")])])]),s("h3",{attrs:{id:"编写shell-vs-nginx-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写shell-vs-nginx-conf"}},[t._v("#")]),t._v(" 编写shell VS nginx.conf")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#deploy_blog.sh\n\n#!/bin/bash\n#去到目录\ncd /home/blog\n\n#更新最新代码\ngit pull\n")])])]),s("p",[t._v("记得赋予deploy.sh执行权限(chmod命令)")]),t._v(" "),s("p",[t._v("配置https请先自行百度.晚点把教程补上")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#nginx.conf\n\n#重定向到https\nserver {\n    listen       80;\n    server_name  fumeck.com www.fumeck.com;\n\trewrite ^/(.*)$ https://www.fumeck.com/$1 permanent;\n}\n\n#开启https\nserver {\n\tlisten 443;\n\tserver_name www.fumeck.com;\n\tssl on;\n\troot html;\n\tindex index.html index.htm;\n\tssl_certificate   cert/3652143_www.fumeck.com.pem;\n\tssl_certificate_key  cert/3652143_www.fumeck.com.key;\n\tssl_session_timeout 5m;\n\tssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n\tssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n\tssl_prefer_server_ciphers on;\n\t\n\tlocation /{\n\t\troot   /home/blog;\n        index  index.html;\n    }\n}\n")])])]),s("h3",{attrs:{id:"云服务器允许ssh远程登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#云服务器允许ssh远程登录"}},[t._v("#")]),t._v(" 云服务器允许SSH远程登录")]),t._v(" "),s("p",[t._v("到目前为止,网站已能访问，但还不够自动化"),s("br"),t._v("\n每次发布文章还得手动的执行deploy_blog.sh脚本."),s("br"),t._v("\n所以这里还差两歩：")]),t._v(" "),s("ul",[s("li",[t._v("1.云服务器允许SSH远程登录")]),t._v(" "),s("li",[t._v("2.Github Actions触发远程更新")])]),t._v(" "),s("p",[t._v("登录"),s("a",{attrs:{href:"https://homenew.console.aliyun.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云控制台"),s("OutboundLink")],1),t._v(",云服务器ECS->网络与安全->密匙对"),s("br"),t._v("\n创建密匙对并绑定到对应的ECS实例中，然后重启实例\n实例就只允许使用RSA密匙的方式登录(旧的密码方式失效)")]),t._v(" "),s("p",[t._v("以下为客户端访问远程服务器测试")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#此时有需要RSA密匙对.可以重用之前的\n#远程服务器放置公匙(已在阿里云密匙对中添加并绑定)\n#客户端放置私匙\nssh-add ~/.ssh/id_rsa\n#默认端口是22.其他端口得加 -p 端口号\nssh-keyscan -t rsa 47.106.96.91\n")])])]),s("h3",{attrs:{id:"出bug了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#出bug了"}},[t._v("#")]),t._v(" 出Bug了")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#执行ssh\nssh -o StrictHostKeyChecking=no -i ~./ssh/id_rsa -A -tt -p 22506 39.108.175.238 ls\n#报如下错误.去掉 -i ~./ssh/id_rsa就不会\ntilde_expand_filename: No such user .\n")])])]),s("p",[t._v("这个暂时找不到原因，Github Actions不会有这个问题，所以先略过")]),t._v(" "),s("p",[t._v("以下是部署方式")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(' deploy-on-aliyun:\n    needs: build-and-deploy\n    # 服务器环境：最新版 Ubuntu\n    runs-on: ubuntu-latest\n    steps:\n      - name: Setup git file\n        env: \n          ACTIONS_DEPLOY_KEY: ${{ secrets.deploy_key }}\n        run: |\n          SSH_PATH="~/.ssh"\n          mkdir -p $SSH_PATH\n          touch "$SSH_PATH/known_hosts"\n          echo "$ACTIONS_DEPLOY_KEY" > "$SSH_PATH/id_rsa"\n          chmod 700 "$SSH_PATH"\n          chmod 600 "$SSH_PATH/known_hosts"\n          chmod 600 "$SSH_PATH/id_rsa"\n          echo "file addad"\n      - name: Setup git excute\n        env: \n          USER: root\n          HOST: 39.108.175.238\n          PORT: 22506\n        run: |\n          SSH_PATH="~/.ssh"\n          eval $(ssh-agent)\n          ssh-add "$SSH_PATH/id_rsa"\n          ssh-keyscan -t rsa -p $PORT $HOST >> "$SSH_PATH/known_hosts"\n          ssh -o StrictHostKeyChecking=no -i $SSH_PATH/id_rsa -A -tt -p $PORT $USER@$HOST ./deploy_blog.sh\n')])])]),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/ddc0b8f8f72a",target:"_blank",rel:"noopener noreferrer"}},[t._v("切换镜像源"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/e3ba86e9c46d",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过GitHub actions发布hugo到私有云服务器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("阮一峰："),s("br"),t._v(" "),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSH原理与运用（一）：远程登录"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSH原理与运用（二）：远程操作与端口转发"),s("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=a.exports}}]);